# SuperInstance Cloud Workers Configuration
# Deploy with: wrangler deploy

name = "superinstance-router"
main = "workers/router/index.ts"
compatibility_date = "2024-01-01"
workers_dev = true

# Account settings (set via environment or wrangler login)
# account_id = ""

[vars]
ENVIRONMENT = "development"

# Rate limiting KV
[[kv_namespaces]]
binding = "RATE_LIMITS"
id = ""
preview_id = ""

# API keys KV
[[kv_namespaces]]
binding = "API_KEYS"
id = ""
preview_id = ""

# Billing Durable Object
[[durable_objects.bindings]]
name = "BILLING_LEDGER"
class_name = "BillingLedger"

[[durable_objects.bindings]]
name = "SESSION_STATE"
class_name = "SessionState"

# Migrations for Durable Objects
[[migrations]]
tag = "v1"
new_classes = ["BillingLedger", "SessionState"]

# R2 Buckets
[[r2_buckets]]
binding = "KNOWLEDGE_STORE"
bucket_name = "superinstance-knowledge"

[[r2_buckets]]
binding = "MODEL_CACHE"
bucket_name = "superinstance-models"

# D1 Database
[[d1_databases]]
binding = "DB"
database_name = "superinstance"
database_id = ""

# Secrets (set via wrangler secret put)
# ANTHROPIC_API_KEY
# OPENAI_API_KEY
# STRIPE_SECRET_KEY

# Production environment
[env.production]
name = "superinstance-router-prod"
workers_dev = false

[env.production.vars]
ENVIRONMENT = "production"

# Routes for production
# [[env.production.routes]]
# pattern = "api.superinstance.ai/*"
# zone_name = "superinstance.ai"

# Staging environment
[env.staging]
name = "superinstance-router-staging"

[env.staging.vars]
ENVIRONMENT = "staging"

# Build configuration
[build]
command = "npm run build"
cwd = "cloud"
watch_dir = "cloud/workers"

# Observability
[observability]
enabled = true

# Limits
[limits]
cpu_ms = 50

# Triggers (cron jobs)
# [[triggers]]
# crons = ["0 * * * *"]  # Hourly billing flush
