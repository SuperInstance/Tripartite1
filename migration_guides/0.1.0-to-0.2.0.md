# Migration Guide: v0.1.0 → v0.2.0

**Status**: Draft (v0.2.0 in development)
**Release Date**: TBD
**Compatibility**: v0.1.0 → v0.2.0

---

## Overview

Version 0.2.0 introduces **Phase 2: Cloud Mesh** infrastructure, adding cloud capabilities while maintaining full backward compatibility with v0.1.0's local-only features.

### Key Changes

- **Added**: Cloud escalation capabilities
- **Added**: Metrics and observability
- **Added**: Enhanced CLI commands (model management, metrics)
- **Improved**: 25-33% latency reduction through parallel agent execution
- **No breaking changes**: All v0.1.0 features work as-is

---

## Breaking Changes

### None

**v0.2.0 is fully backward compatible with v0.1.0**.

All existing configurations, vaults, token vaults, and workflows continue to work without modification.

---

## New Features

### 1. Cloud Escalation (Phase 2 - In Development)

**What**: Ability to escalate queries to cloud models (Claude, GPT-4) when local models are insufficient.

**How to use**:
```bash
# Enable cloud (requires API key)
synesis cloud login <api-key>

# Escalate to cloud
synesis ask "Complex query" --cloud

# Specify model
synesis ask "Query" --cloud --model claude-opus
```

**Configuration**:
```toml
[cloud]
enabled = true
api_key = "sk-..."  # Stored in keychain, not config file
default_model = "auto"  # auto, claude-sonnet, claude-opus, gpt-4-turbo
```

---

### 2. Metrics and Observability

**What**: Comprehensive metrics collection for monitoring and debugging.

**How to use**:
```bash
# View metrics
synesis metrics show

# Export metrics (Prometheus format)
synesis metrics export --format prometheus > metrics.txt

# Reset metrics
synesis metrics reset
```

**Metrics tracked**:
- Query latency (p50, p95, p99)
- Agent processing times
- Consensus rounds and failures
- RAG operations (indexed, searched)
- Privacy operations (redactions, tokens)
- Cloud escalation count and cost

---

### 3. Model Management CLI

**What**: New CLI commands for managing local models.

**How to use**:
```bash
# List available models
synesis model list

# Download a model
synesis model download mistral-7b-instruct-v0.2

# View model details
synesis model info mistral-7b-instruct-v0.2

# Remove a model
synesis model remove phi-3-mini

# Verify model integrity
synesis model verify mistral-7b-instruct-v0.2
```

---

### 4. Parallel Agent Execution

**What**: Agents now run in parallel instead of sequentially, reducing consensus latency by 25-33%.

**Automatic**: No configuration needed. This improvement is transparent to users.

**Performance impact**:
- Before: ~3.7s for agent processing
- After: ~1.4s for agent processing
- **Improvement**: 62% faster agent processing

---

### 5. Enhanced Error Messages

**What**: Unified `SynesisError` type provides clearer, more actionable error messages.

**Example**:
```rust
// Before
Error: Io(Os { code: 2, kind: NotFound, message: "No such file or directory" })

// After
Error: Knowledge vault not found at path: /path/to/vault
Hint: Run 'synesis init' to create a new vault, or check the path in your config.
```

---

## Deprecated Features

### None

No features are deprecated in v0.2.0.

---

## Pre-Migration Checklist

### Required for All Users

- [ ] Backup knowledge vault
- [ ] Backup configuration file
- [ ] Backup token vault (if contains important data)

### Required for Cloud Features

- [ ] Obtain API key from cloud provider
- [ ] Ensure network connectivity
- [ ] Review billing information

### Optional

- [ ] Document current config settings
- [ ] Note current model versions
- [ ] Record baseline metrics for comparison

---

## Step-by-Step Migration

### Step 1: Backup Your Data

```bash
# Backup knowledge vault
cp -r ~/.synesis/knowledge ~/.synesis/knowledge.backup.0.1.0

# Backup configuration
cp ~/.synesis/config.toml ~/.synesis/config.backup.0.1.0.toml

# Backup token vault
cp ~/.synesis/tokens.db ~/.synesis/tokens.backup.0.1.0.db
```

**Why**: Ensures you can rollback if needed.

---

### Step 2: Stop Running Instances

```bash
# Ensure no synesis processes are running
pkill synesis

# Verify
ps aux | grep synesis  # Should return nothing
```

**Why**: Prevents data corruption during upgrade.

---

### Step 3: Install v0.2.0

```bash
# Option A: Build from source
cd /path/to/Tripartite1
git fetch
git checkout v0.2.0
cargo build --release

# Option B: Download binary (when available)
wget https://github.com/SuperInstance/Tripartite1/releases/download/v0.2.0/synesis-linux-amd64
chmod +x synesis-linux-amd64
sudo mv synesis-linux-amd64 /usr/local/bin/synesis
```

**Why**: Installs the new version.

---

### Step 4: Verify Installation

```bash
# Check version
synesis --version
# Expected output: synesis 0.2.0

# Check system status
synesis status
```

**Why**: Confirms installation succeeded.

---

### Step 5: Run Data Migration (If Needed)

```bash
# Data migration is automatic for most users
# If you have custom vault configurations:
synesis migrate --from 0.1.0 --to 0.2.0
```

**Why**: Updates data formats if necessary.

**Note**: For most users, no migration is needed as v0.2.0 is backward compatible.

---

### Step 6: Test Core Functionality

```bash
# Test 1: Basic query
synesis ask "What is 2 + 2?"
# Expected: Normal response with tripartite consensus

# Test 2: Knowledge vault
synesis knowledge stats
# Expected: Shows vault statistics

# Test 3: Privacy
synesis ask "Email test@example.com for info"
# Expected: Email redacted

# Test 4: Metrics
synesis metrics show
# Expected: Shows metrics dashboard
```

**Why**: Verifies that v0.1.0 features still work.

---

### Step 7: (Optional) Configure Cloud Features

```bash
# Login to cloud
synesis cloud login <your-api-key>

# Set default model
synesis config set cloud.default_model claude-sonnet

# Test cloud escalation
synesis ask "Explain quantum entanglement" --cloud
```

**Why**: Enables new cloud features if desired.

**Note**: Cloud features are optional. v0.2.0 works perfectly without them.

---

### Step 8: (Optional) Update Configuration

While no configuration changes are required, you may want to add new options:

```toml
# Add to ~/.synesis/config.toml

[cloud]
# Cloud features (optional)
enabled = false  # Set to true to enable
default_model = "auto"

[metrics]
# Metrics collection (optional)
enabled = true
retention_days = 30

[agents]
# Agent tuning (optional)
max_concurrent = 3  # Reduce if CPU-limited
```

**Why**: Enables new features and customization options.

---

## Post-Migration Verification

### Verification Checklist

- [ ] Version shows 0.2.0: `synesis --version`
- [ ] Local queries work: `synesis ask "test"`
- [ ] Knowledge vault accessible: `synesis knowledge stats`
- [ ] Privacy redaction works: Check for token replacements
- [ ] Metrics being tracked: `synesis metrics show`
- [ ] No errors in logs: Check `~/.synesis/logs/`
- [ ] Config valid: `synesis config list`

### Performance Comparison

Compare metrics before and after migration:

```bash
# Before migration (if you recorded baseline)
synesis metrics export > before.txt

# After migration
synesis metrics export > after.txt

# Compare (note: parallel execution should be faster)
diff before.txt after.txt
```

**Expected changes**:
- Query latency: 25-33% faster (due to parallel agent execution)
- New metrics categories: cloud, models
- Memory usage: Similar to v0.1.0

---

## Rollback Instructions

If you encounter issues and need to rollback to v0.1.0:

### Step 1: Stop v0.2.0

```bash
pkill synesis
```

---

### Step 2: Restore v0.1.0 Binary

```bash
# If you kept the old binary
sudo cp /usr/local/bin/synesis.backup.0.1.0 /usr/local/bin/synesis

# Or rebuild from source
cd /path/to/Tripartite1
git checkout v0.1.0
cargo build --release
sudo cp target/release/synesis /usr/local/bin/synesis
```

---

### Step 3: Restore Data

```bash
# Restore knowledge vault
rm -rf ~/.synesis/knowledge
cp -r ~/.synesis/knowledge.backup.0.1.0 ~/.synesis/knowledge

# Restore configuration
cp ~/.synesis/config.backup.0.1.0.toml ~/.synesis/config.toml

# Restore token vault
cp ~/.synesis/tokens.backup.0.1.0.db ~/.synesis/tokens.db
```

---

### Step 4: Verify Rollback

```bash
synesis --version
# Expected: synesis 0.1.0

synesis ask "test"
# Expected: Normal response
```

---

### Step 5: Report Issues

If you needed to rollback, please report the issue:

1. Check [GitHub Issues](https://github.com/SuperInstance/Tripartite1/issues)
2. Create a new issue if not already reported
3. Include:
   - Steps you took
   - Error messages
   - System info: `synesis status`
   - Log files: `~/.synesis/logs/`

---

## Known Issues

### Issue 1: Cloud Features in Development

**Status**: Expected

**Impact**: Cloud escalation, billing, and LoRA features are still in development.

**Workaround**: Use v0.2.0 for local-only features (same as v0.1.0).

**Timeline**: Expected completion in Phase 2 (v0.3.0).

---

### Issue 2: Model Download Requires Manual Verification

**Status**: Known limitation

**Impact**: `synesis model download` downloads models but requires manual verification currently.

**Workaround**: Models are verified on first use automatically.

**Fix planned**: Automatic checksum verification in v0.2.1.

---

### Issue 3: Metrics Retention Not Enforced

**Status**: Known limitation

**Impact**: Old metrics files are not automatically cleaned up.

**Workaround**: Manually clean `~/.synesis/metrics/` directory.

**Fix planned**: Automatic cleanup in v0.2.1.

---

## Configuration Changes

### New Configuration Options

These options are **optional**. v0.2.0 works without them.

```toml
# Cloud configuration (optional)
[cloud]
enabled = false  # Enable cloud features
api_key = ""  # NOT recommended to store here (use keychain)
default_model = "auto"  # auto, claude-sonnet, claude-opus, gpt-4-turbo
timeout_seconds = 30
max_tokens = 4096

# Metrics configuration (optional)
[metrics]
enabled = true
retention_days = 30
export_format = "prometheus"  # prometheus, json

# Agent tuning (optional)
[agents]
max_concurrent = 3  # Max parallel agents
timeout_seconds = 30

# Model management (optional)
[models]
auto_update = false
download_path = "~/.synesis/models"
cache_size_gb = 50
```

### Deprecated Configuration Options

**None**

---

## Data Migration Details

### Knowledge Vault Schema

**Changes**: None. v0.2.0 uses the same SQLite-VSS schema as v0.1.0.

**Migration**: Not required. Vaults are fully compatible.

---

### Token Vault Schema

**Changes**: None. Same schema with global counters per category.

**Migration**: Not required. Token vaults are fully compatible.

---

### Configuration Format

**Changes**: New optional sections added (cloud, metrics, models).

**Migration**: Not required. Old configs work as-is. New sections use defaults if not specified.

---

## Performance Changes

### Expected Performance Improvements

1. **Parallel agent execution**: 25-33% faster query latency
2. **Optimized consensus engine**: Reduced overhead
3. **Better caching**: Improved model loading

### Benchmark Comparison

**Test query**: "How does the authentication system work?"
**Hardware**: Intel i7-12700K, RTX 4090, 32GB RAM

| Version | Latency | Improvement |
|---------|---------|-------------|
| v0.1.0 | 3.2s | Baseline |
| v0.2.0 | 2.4s | **25% faster** |

**Your mileage may vary** depending on hardware and query complexity.

---

## Additional Resources

### Documentation

- [CHANGELOG.md](../CHANGELOG.md) - Complete version history
- [README.md](../README.md) - Project overview
- [ARCHITECTURE.md](../ARCHITECTURE.md) - System design
- [PERFORMANCE.md](../PERFORMANCE.md) - Performance characteristics
- [COMPARISON.md](../COMPARISON.md) - Comparison with alternatives

### Community

- [GitHub Issues](https://github.com/SuperInstance/Tripartite1/issues) - Bug reports
- [GitHub Discussions](https://github.com/SuperInstance/Tripartite1/discussions) - Questions
- [Contributing Guide](../CONTRIBUTING.md) - How to contribute

---

## FAQ

### Q: Is v0.2.0 production-ready?

**A**: For local-only features (v0.1.0 feature set), yes. For cloud features, they're still in development (Phase 2).

---

### Q: Do I need to migrate to v0.2.0?

**A**: Not immediately. v0.1.0 is still supported. However, v0.2.0 offers performance improvements and new features.

---

### Q: Will my v0.1.0 vaults work with v0.2.0?

**A**: Yes, fully compatible. No migration required.

---

### Q: Can I use v0.2.0 without cloud features?

**A**: Yes, absolutely. Cloud features are optional. v0.2.0 works great as a local-only system.

---

### Q: How long does migration take?

**A**: Typically 5-10 minutes:
- Backup: 1-2 minutes
- Installation: 2-3 minutes
- Testing: 2-5 minutes

---

### Q: What if I encounter a bug?

**A**:
1. Check [Known Issues](#known-issues) section
2. Search [GitHub Issues](https://github.com/SuperInstance/Tripartite1/issues)
3. Create a new issue with details
4. You can rollback to v0.1.0 if needed

---

## Support

### Getting Help

- **Documentation**: Start with [README.md](../README.md)
- **Troubleshooting**: Check [TROUBLESHOOTING.md](../TROUBLESHOOTING.md)
- **Issues**: [GitHub Issue Tracker](https://github.com/SuperInstance/Tripartite1/issues)
- **Discussions**: [GitHub Discussions](https://github.com/SuperInstance/Tripartite1/discussions)

### Reporting Bugs

When reporting bugs, please include:

1. **Version**: `synesis --version`
2. **OS/Hardware**: `synesis status`
3. **Steps to reproduce**: What you did
4. **Expected behavior**: What you expected
5. **Actual behavior**: What happened instead
6. **Error messages**: Full error output
7. **Logs**: `~/.synesis/logs/synesis.log`

---

**Migration Guide Version**: 1.0.0
**Last Updated**: 2026-01-07
**For SuperInstance AI**: v0.1.0 → v0.2.0
**Repository**: [SuperInstance/Tripartite1](https://github.com/SuperInstance/Tripartite1)
